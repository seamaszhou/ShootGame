<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>

    <script type="text/javascript" src="JS/pixi.js"></script>


    <meta charset="utf-8">
    <title>ShootGame</title>
  </head>
  <body>

    <style media="screen">
      *{padding : 0;
        margin:0}
    </style>

    <script type="text/javascript">
    let Ellie, Ellie_run, state;

      let type = "WebGL";
      if (!PIXI.utils.isWebGLSupported()) {
        type = "canvas";

      };

      PIXI.utils.sayHello(type);
      // let texture = PIXI.utils.TextureCache["Ellie/GIF/idle.gif"];
      // let sprite = new PIXI.Sprite(texture);

      let app = new PIXI.Application({width:1024,
        height:512,
        antialias: true,
        transparent: false,
        resolution: 1}

      );

      //Full screen
      app.renderer.view.style.position = "absolute";
      app.renderer.view.style.display = "block";
      app.renderer.autoResize = true;
      app.renderer.resize(window.innerWidth, window.innerHeight);
      app.renderer.backgroundColor = 0x34495e;

      //
      document.body.appendChild(app.view),PIXI.loader.add("Ellie/Frames/Ellie frame_idle_0.png").add("Ellie/Frames/Ellie frame_idle_1.png").add("Ellie/Frames/Ellie frame_idle_2.png").add("Ellie/Frames/Ellie frame_idle_3.png").add("Ellie/Frames/Ellie frame_run_00.png").add("Ellie/Frames/Ellie frame_run_01.png").add("Ellie/Frames/Ellie frame_run_02.png").add("Ellie/Frames/Ellie frame_run_03.png").add("Ellie/Frames/Ellie frame_run_04.png").add("Ellie/Frames/Ellie frame_run_05.png").add("Ellie/Frames/Ellie frame_run_06.png").add("Ellie/Frames/Ellie frame_run_07.png").add("Ellie/Frames/Ellie frame_run_08.png").add("Ellie/Frames/Ellie frame_run_09.png").add("Ellie/Frames/Ellie frame_run_10.png").add("Ellie/Frames/Ellie frame_run_11.png").add("Ellie/Frames/Ellie frame_run_12.png").on("progress",loadProgress).load(setup);

      //monitor loading progress
      function loadProgress(loader, resource){
        console.log("loading" + resource.url);

        console.log("progress" + loader.progress + "%");
      }



      function setup(){
        //idle
        let Ellie_spirit  = "Ellie/Frames/", idle_array = [];
        for (let $e = 0; $e < 3; $e++){
          idle_array.push(Ellie_spirit + "Ellie frame_idle_"+($e+1)+".png");
        }

        //run
        let run_array = [];
        for (let $e = 0; $e < 12; $e++){
          run_array.push(Ellie_spirit + "Ellie frame_run_"+($e+1)+".png");
        }

        //arrow key
        let left = keyboard(65),
            up = keyboard(38),
            right = keyboard(68),
            down = keyboard(40);

        //left arrow


        // let Ellie = new PIXI.Sprite(PIXI.loader.resources["Ellie/Frames/Ellie frame_idle_0.png"].texture);
        Ellie = new PIXI.extras.AnimatedSprite.fromImages(idle_array)
        Ellie_run = new PIXI.extras.AnimatedSprite.fromImages(run_array)
        app.stage.addChild(Ellie);

        state = play;

        app.ticker.add(delta => gameLoop(delta));

        Ellie.animationSpeed = 0.1;
        Ellie.play();
        Ellie.position.set(500,300);
        Ellie.vx = 0;
        Ellie.vy = 0;



        right.press = () =>{
          Ellie_run.vx = 5;
          Ellie_run.vy = 0;

          Ellie_run.animationSpeed = 0.1;
          Ellie_run.play();
          app.stage.removeChild(Ellie);
          app.stage.addChild(Ellie_run);
          Ellie_run.position.set(500,300);
          console.log('test');
        }

        right.release = () =>{
          if(!left.isDown && Ellie_run.vy === 0){

            Ellie_run.vx = 0;
            app.stage.addChild(Ellie);
            app.stage.removeChild(Ellie_run);
            Ellie_run.position;
          }
        }

      };

      function gameLoop(delta){
      state(delta);
      }

      function play(delta){
        Ellie_run.x += Ellie_run.vx;
        Ellie_run.x += Ellie_run.vy;

      }

      function keyboard(keyCode){
        let key = {};
        key.code = keyCode;
        key.isDown = false;
        key.isUp = true;
        key.press = undefined;
        key.release = undefined;

        key.downHandler = event =>{
          if (event.keyCode === key.code){
            if(key.isUp && key.press)key.press();
            key.isDown = true;
            key.isUp = false;
          };
          event.preventDefault();
        };

        key.upHandler = event => {
          if (event.keyCode === key.code) {
          if (key.isDown && key.release) key.release();
          key.isDown = false;
          key.isUp = true;
        };
        event.preventDefault();
        };

        window.addEventListener("keydown", key.downHandler.bind(key), false);
        window.addEventListener("keyup", key.upHandler.bind(key), false);
        return key;



      };


      //
      // function pageUpdate(){
      //   requestAnimationFrame(pageUpdate);
      //   pixiRender.render(objPixiContainer);
      // }
      //This `setup` function will run when the image has loaded

    </script>

  </body>
</html>
